(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[297],{4699:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/collection/[type]",function(){return a(7120)}])},7221:function(e,t,a){"use strict";a.d(t,{n:function(){return u}});var s=a(9105),r=a(8218),l=a(9810),n=a(3863),i=a(1590);let c=async e=>{try{let t=async t=>{let a=[],l="users/".concat(e,"/collection/marks/").concat(t),n=(0,s.iH)(r.F,l),i=await (0,s.U2)(n);return i.exists()&&i.forEach(e=>{let t=e.val();a.push(t)}),a},a=await t(i.zS.movie),l=await t(i.zS.tv);return[...a,...l]}catch(e){throw e}},o=async(e,t)=>{let a=t.type;try{switch(a){case"movie":case"tv":case"person":let r=await Promise.all(e.map(async e=>{let a=await (0,l.R)(t.type,e,"");return a})),i=(0,n.v)(r);return i;case"reviews":case"replies":return await Promise.all(e.map(async e=>{let a=await (0,s.U2)((0,s.iU)(t.ref,e));return a.val()}));case"marks":return await c(t.userId)}}catch(e){throw e}},u=async function(e,t,a){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;try{let n;let i=(0,s.iH)(r.F,"users/".concat(e,"/")),c=await (0,s.U2)(i);if(!c.exists())throw"Failed to fetch";let u="users/".concat(e,"/collection/").concat(t,"/"),h=(0,s.iH)(r.F,u);n=l?null!==a?(0,s.IO)(h,(0,s.R)(),(0,s.TQ)(l),(0,s.Kk)(a+1)):(0,s.IO)(h,(0,s.R)(),(0,s.TQ)(l)):null!==a?(0,s.IO)(h,(0,s.R)(),(0,s.Kk)(a+1)):(0,s.IO)(h,(0,s.R)());let m=await (0,s.U2)(n),f=m.val()||{},y=Object.keys(f),d=!1;if(null!==a&&y.length>a&&(d=!0,y.pop()),!y.length)return{isMoreDataAvailable:d,items:[]};let p=await o(y,{type:t,ref:h,userId:e});return{isMoreDataAvailable:d,items:p}}catch(e){throw e}}},7120:function(e,t,a){"use strict";a.r(t),a.d(t,{__N_SSP:function(){return j},default:function(){return I}});var s=a(5893),r=a(1207),l=a(4193),n=a(1654),i=a(4628),c=a(4033),o=a(7294),u=a(8642),h=a(7221),m=a(9105),f=a(8218);let y=(e,t)=>{let{collectionType:a,oldItems:s,setItems:r,setIsMoreDataAvailable:l}=t,n="users/".concat(e,"/collection/").concat(a),i=(0,m.iH)(f.F,n),c=()=>new Promise(async e=>{(0,m.U2)(i).then(t=>{let a=[];t.exists()&&t.forEach(e=>{a.push(e.val())}),e(a)})}),o=async e=>{let t=e.val(),a=await c(),n=a.length,i=s.length,o=s.filter(e=>e.id!==t.id);r(o),l(n>i)},u=(0,m.MQ)(i,o);return()=>{u()}};var d=(e,t)=>{let{isMoreDataAvailable:a,collectionType:s}=t,[r,l]=(0,o.useState)(!0),[n,i]=(0,o.useState)(!1),[c,m]=(0,o.useState)(void 0),[f,d]=(0,o.useState)([]),[p,w]=(0,o.useState)(!1),{userId:v}=(0,u.a)(),x=async()=>{i(!0);let e=await (0,h.n)(v,s,20,c);d(t=>[...t,...e.items]),w(e.isMoreDataAvailable),i(!1),m(void 0)};return(0,o.useEffect)(()=>{let e=y(v,{collectionType:s,oldItems:f,setItems:d,setIsMoreDataAvailable:w});return()=>{e()}},[f]),(0,o.useEffect)(()=>{(c||!f.length&&p&&!r)&&x()},[c,f,p]),(0,o.useEffect)(()=>{d(e),setTimeout(()=>{w(a)},1500),l(!1)},[e]),{isShowMoreButton:p,isLoading:n,itemsToShow:f,showMore:()=>{m(f[f.length-1].id.toString())}}},p=e=>{let{collectionType:t,items:a,isMoreDataAvailable:o,title:u}=e,{isShowMoreButton:h,isLoading:m,itemsToShow:f,showMore:y}=d(a,{isMoreDataAvailable:o,collectionType:t});return f.length?(0,s.jsxs)("div",{className:"mb-16",children:[(0,s.jsx)(n.Z,{children:u}),(0,s.jsx)("div",{className:"grid grid-cols-[repeat(auto-fill,232px)] gap-x-5 justify-center",children:f.map(e=>(0,s.jsx)(r.Z,{item:e,collectionType:t,isCollectionListItem:!0},e.id))}),m&&(0,s.jsx)(i.Z,{type:"static"}),f.length>0&&h&&(0,s.jsx)(l.Z,{className:"mx-auto",context:"empty",onClick:y,children:"Show more"})]}):(0,s.jsx)(c.Z,{title:u})},w=a(1163),v=a(3155),x=a(1084),g=a(1590),_=a(6986);let S=async(e,t,a,s)=>{let r=!a&&!e;r&&s("/404");let l=!a||!e,n=a&&e&&a!==e;(n||l)&&s(_.A6.replace("{userId}",a));try{let r=await (0,h.n)(e,t,20),l=!r.items.length;return l&&s(_.A6.replace("{userId}",a)),r}catch(e){return null}};var j=!0,I=e=>{let{specificCollectionPageProps:t}=e,[a,r]=(0,o.useState)(null),l=(0,w.useRouter)(),{userId:n}=(0,u.a)(),c=l.query.type===g.zS.movie?"Movies from your collection":"Persons from your collection",h=l.query.type;return((0,o.useEffect)(()=>{let e=async()=>{let e=l.query.uid,t=await S(e,h,n,e=>{l.push(e)});r(t)};t?r(t):e()},[t]),a)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.Z,{imageSrc:x.dK}),(0,s.jsx)(p,{collectionType:h,items:a?a.items:[],isMoreDataAvailable:!!a&&a.isMoreDataAvailable,title:c})]}):(0,s.jsx)(i.Z,{className:"bg-transparent"})}}},function(e){e.O(0,[885,347,342,774,888,179],function(){return e(e.s=4699)}),_N_E=e.O()}]);