"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[951],{4240:function(e,t,s){var l=s(5893),n=s(4193),c=s(9603);t.Z=e=>{let{label:t,icon:s,onClick:a,closeList:i}=e;return(0,l.jsxs)(n.Z,{context:"icon-text",className:"w-full text-left",onClick:e=>{a(e),i&&i()},children:[(0,l.jsx)(c.G,{icon:s,className:"mr-2"}),(0,l.jsx)("span",{children:t})]})}},9989:function(e,t,s){var l=s(5893),n=s(7294),c=s(4193),a=s(9603),i=s(9417),o=s(6701),r=s(4184),d=s.n(r);t.Z=e=>{let{children:t,icon:s="dots",className:r}=e,[m,u]=(0,n.useState)(!1),h=()=>{u(!1)},x=n.Children.map(t,e=>(0,n.isValidElement)(e)?(0,n.cloneElement)(e,{closeList:h}):e);return(0,l.jsxs)("span",{className:d()("absolute top-2 right-2 md:top-4 md:right-4",r),onMouseLeave:h,children:[(0,l.jsx)(c.Z,{className:"!absolute top-0 right-0",context:"icon",onClick:()=>{u(!m)},children:(0,l.jsx)(a.G,{icon:"settings"===s?i.gr5:i.Uwo,className:"w-6 h-6"})}),(0,l.jsx)(o.Z,{in:m,timeout:300,classNames:"dropdown",unmountOnExit:!0,children:(0,l.jsx)("span",{className:"w-52 relative right-0 pt-14 block z-50",children:(0,l.jsx)("span",{className:"w-full p-2 rounded-md bg-gray-600 block",children:x})})})]})}},8960:function(e,t,s){var l=s(5893),n=s(1654),c=s(9603),a=s(9417);t.Z=e=>{let{title:t,text:s}=e;return(0,l.jsxs)("div",{className:"w-full h-full flex flex-col justify-center items-center flex-1 text-center",children:[(0,l.jsx)(c.G,{icon:a.QLU,className:"text-rose-600 text-2xl mb-4"}),(0,l.jsx)(n.Z,{variant:"h3",children:t}),(0,l.jsx)("p",{className:"text-sm text-gray-500",children:s})]})}},6406:function(e,t,s){var l=s(5893),n=s(9544),c=s(4184),a=s.n(c);t.Z=e=>{let{onChange:t,value:s,error:c,placeholder:i="Enter text...",className:o}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("textarea",{value:s,onChange:e=>{let s=e.target.value;t(s)},onClick:e=>e.preventDefault(),rows:6,className:a()("w-full bg-transparent p-4 border border-gray-500 hover:border-white duration-300 resize-none outline-none block",o,c&&"!border-rose-600"),placeholder:i}),c&&(0,l.jsx)(n.Z,{className:"self-start",error:c})]})}},8878:function(e,t,s){s.d(t,{Z:function(){return w}});var l=s(5893),n=s(7294),c=s(3028),a=s(3087),i=s(1664),o=s.n(i),r=s(9608),d=s(9810);let m=async(e,t)=>{let s=await (0,d.R)(t,e,"");return s.poster_path||s.profile_path};var u=s(9417),h=s(9603),x=s(4184),p=s.n(x),f=s(1590),v=s(1084),w=e=>{let{itemId:t,collectionType:s,mark:i,isLinkToMovie:d=!1,className:x=!1}=e,[w,j]=(0,n.useState)(""),y=w?v.hm.replace("{imageSrc}",w):"";(0,n.useEffect)(()=>{m(t,s).then(e=>{j(e)})},[]);let k=(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.Z,{className:"duration-300 mb-4 border-4",src:y,defaultImage:s!==f.zS.person?c.Z:a.Z}),i&&(0,l.jsxs)("span",{className:"flex justify-center items-center",children:[(0,l.jsx)(h.G,{icon:u.Tab,className:"text-rose-500"}),(0,l.jsx)("span",{className:"ml-1 font-semibold",children:i})]})]});return(0,l.jsx)("span",{className:p()(!i&&"w-24 h-36","flex-none",x),children:d?(0,l.jsx)(o(),{href:"/".concat(s,"/[id]"),as:"/".concat(s,"/").concat(t),children:k}):k})}},5049:function(e,t,s){s.d(t,{Z:function(){return j}});var l=s(5893),n=s(7294),c=s(6406),a=s(1654),i=s(4193),o=s(1199),r=s(381),d=s.n(r),m=s(2624),u=s(7245),h=s(9299),x=s(4628),p=s(1590),f=s(9105),v=s(8218);let w=async(e,t)=>{let{newItem:s,reviewedItemId:l,collectionType:n,reviewedItemCollectionType:c}=t,a="users/".concat(e,"/collection/").concat(n,"/").concat(c,"/").concat(s.id),i="".concat(c,"/").concat(l,"/").concat(n,"/").concat(s.id),o=(0,f.iH)(v.F,a),r=(0,f.iH)(v.F,i);await (0,f.t8)(o,s),await (0,f.t8)(r,s)};var j=e=>{let{reviewedItemId:t,reviewedItemCollectionType:s,userId:r,reviewAuthorId:f,reviewId:v,replyToUser:j,isReplyItem:y=!1,onFormClose:k}=e,[I,g]=(0,n.useState)(!1),[b,N]=(0,n.useState)(""),[C,S]=(0,n.useState)(""),{showModal:Z}=(0,u.d)(),R=I?(0,l.jsx)(x.Z,{type:"static"}):(0,l.jsx)(l.Fragment,{children:"".concat(y?"Submit reply":"Submit review")}),T=()=>{k&&k(!1)},F=async e=>{if(e.preventDefault(),g(!0),""!==b.trim()){if(r){let e;S(""),e=y?{...void 0!==f&&{reviewAuthorId:f},reviewedItemId:t,replyToUser:j,reviewId:v,id:(0,o.k$)(),content:b,created_at:d()().format(),authorId:r,reviewedItemCollectionType:s}:{reviewedItemId:t,id:(0,o.k$)(),content:b,created_at:d()().format(),authorId:r,reviewedItemCollectionType:s};let l={newItem:e,reviewedItemId:t,collectionType:y?p.zS.replies:p.zS.reviews,reviewedItemCollectionType:s};await w(r,l),N(""),y&&T()}else(0,m.Mo)(Z)}else S(h.R.REQUIRED_FIELD);g(!1)};return(0,n.useEffect)(()=>{N(""),S("")},[t]),(0,l.jsxs)(l.Fragment,{children:[y?(0,l.jsx)(a.Z,{variant:"h3",className:"mt-8",children:"Leave your reply to ".concat(j)}):(0,l.jsx)(a.Z,{children:"Leave your review"}),(0,l.jsxs)("form",{children:[(0,l.jsx)(c.Z,{onChange:e=>{N(e),S("")},value:b,error:C}),(0,l.jsxs)("span",{className:"mt-8 flex justify-start items-center",children:[(0,l.jsx)(i.Z,{onClick:F,children:R}),y&&(0,l.jsx)(i.Z,{context:"filledDark",className:"ml-2",onClick:T,children:"Cancel"})]})]})]})}},4914:function(e,t,s){s.d(t,{Z:function(){return ea}});var l=s(5893),n=s(1654),c=s(4193),a=s(7294),i=s(381),o=s.n(i),r=s(4184),d=s.n(r),m=s(9603),u=s(9417),h=e=>{let{title:t,action:s,onClick:n,counter:a,isCurrentUserReaction:i}=e,o="mr-1";return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)(c.Z,{className:d()("mr-2",i&&"text-rose-500 !bg-rose-900/30"),context:"icon-text",onClick:n,children:[(()=>{switch(s){case"like":case"reply":return(0,l.jsx)(m.G,{icon:u.u8Q,className:o});case"dislike":return(0,l.jsx)(m.G,{icon:u.u8Q,className:d()(o,"rotate-180")})}})(),t,(0,l.jsx)("span",{className:"ml-1",children:a})]})})},x=s(2624),p=s(7245),f=s(9105),v=s(8218);let w=async(e,t)=>{let{reviewedItemId:s,collectionType:l,reviewedItemCollectionType:n}=t,c="reviewsReactions/".concat(n,"/").concat(s,"/").concat(l,"/").concat(e,"/likes/"),a="reviewsReactions/".concat(n,"/").concat(s,"/").concat(l,"/").concat(e,"/dislikes/"),i=(0,f.iH)(v.F,c),o=(0,f.iH)(v.F,a),r=await new Promise(async e=>{(0,f.U2)(i).then(t=>{let s=[];t.forEach(e=>{let t={key:e.key,data:e.val()};s.push(t)}),e(s)})}),d=await new Promise(async e=>{(0,f.U2)(o).then(t=>{let s=[];t.forEach(e=>{let t={key:e.key,data:e.val()};s.push(t)}),e(s)})});return{likes:r,dislikes:d}};var j=s(5276);let y=(e,t)=>{let{reviewedItemId:s,collectionType:l,setReactions:n,reviewedItemCollectionType:c}=t,a="reviewsReactions/".concat(c,"/").concat(s,"/").concat(l,"/").concat(e,"/likes"),i="reviewsReactions/".concat(c,"/").concat(s,"/").concat(l,"/").concat(e,"/dislikes"),o=(0,f.iH)(v.F,a),r=(0,f.iH)(v.F,i),d=[],m=[],u=(0,j.jM)(o,e=>{d.length=0,e.forEach(e=>{d.push({key:e.key,data:e.val()})}),n(e=>({likes:d,dislikes:e.dislikes}))}),h=(0,j.jM)(r,e=>{m.length=0,e.forEach(e=>{m.push({key:e.key,data:e.val()})}),n(e=>({likes:e.likes,dislikes:m}))});return()=>{u(),h()}},k=(e,t)=>{let{reviewId:s,reviewedItemId:l,collectionType:n,reactionType:c,reviewedItemCollectionType:a}=t,i="users/".concat(e,"/collection/").concat(n,"/").concat(a,"/").concat(s,"/").concat("like"===c?"dislikes":"likes","/").concat(e),o="reviewsReactions/".concat(a,"/").concat(l,"/").concat(n,"/").concat(s,"/").concat("like"===c?"dislikes":"likes","/").concat(e),r=(0,f.iH)(v.F,i),d=(0,f.iH)(v.F,o);return new Promise(async e=>{let t=!1;(0,f.Od)(r).then(()=>{(0,f.Od)(d).then(()=>{t=!0})}),e(t)})},I=async(e,t)=>{let{reviewId:s,reviewedItemId:l,collectionType:n,reactionType:c,reviewedItemCollectionType:a}=t,i="users/".concat(e,"/collection/").concat(n,"/").concat(a,"/").concat(s,"/").concat("like"===c?"likes":"dislikes","/").concat(e),o="reviewsReactions/".concat(a,"/").concat(l,"/").concat(n,"/").concat(s,"/").concat("like"===c?"likes":"dislikes","/").concat(e),r=(0,f.iH)(v.F,i),d=(0,f.iH)(v.F,o);await (0,f.t8)(r,s),await (0,f.t8)(d,s),await k(e,t)};var g=e=>{let{reviewId:t,reviewedItemId:s,userId:n,onReply:c,collectionType:i,reviewedItemCollectionType:o}=e,{showModal:r}=(0,p.d)(),[d,m]=(0,a.useState)({likes:[],dislikes:[]}),u=d.likes.length>0&&d.likes.some(e=>e.key===n),f=d.dislikes.length>0&&d.dislikes.some(e=>e.key===n),v=async(e,l,c)=>{if(n){let e={reviewId:t,reviewedItemId:s,collectionType:c,reactionType:l,reviewedItemCollectionType:o};j(l)?await k(n,e):await I(n,e)}else(0,x.Mo)(r)},j=e=>"like"===e?u:"dislike"===e&&f;return(0,a.useEffect)(()=>{w(t,{reviewedItemId:s,collectionType:i,reviewedItemCollectionType:o}).then(e=>{m({likes:e.likes,dislikes:e.dislikes})})},[]),(0,a.useEffect)(()=>{if(n){let e=y(t,{reviewedItemId:s,collectionType:i,setReactions:m,reviewedItemCollectionType:o});return()=>{e()}}},[d,n]),(0,l.jsxs)("span",{className:"flex justify-start items-center mt-auto",children:[(0,l.jsx)(h,{title:"Like",action:"like",onClick:e=>v(e,"like",i),counter:d.likes.length,isCurrentUserReaction:u}),(0,l.jsx)(h,{title:"Dislike",action:"dislike",onClick:e=>v(e,"dislike",i),counter:d.dislikes.length,isCurrentUserReaction:f}),(0,l.jsx)(h,{title:"Reply",action:"reply",onClick:c})]})},b=s(5049),N=s(6406),C=s(9299),S=s(1590);let Z=async(e,t)=>{let{item:s,reviewedItemId:l,collectionType:n,reviewedItemCollectionType:c}=t,a=s.id,i="users/".concat(e,"/collection/").concat(n,"/").concat(c,"/").concat(a),o="".concat(c,"/").concat(l,"/").concat(n,"/").concat(a),r=(0,f.iH)(v.F,i),d=(0,f.iH)(v.F,o),m=await (0,f.U2)(r);return!!m.exists()&&(await (0,f.Vx)(r,s),await (0,f.Vx)(d,s),!0)};var R=e=>{let{editedItem:t,reviewedItemId:s,reviewedItemCollectionType:n,onFormClose:i,isReplyItem:o=!1}=e,[r,d]=(0,a.useState)(t.content),[m,u]=(0,a.useState)(""),h=async e=>{if(e.preventDefault(),""!==r.trim()){let e;u(""),e={...t,content:r};let l={item:e,reviewedItemId:s,collectionType:o?S.zS.replies:S.zS.reviews,reviewedItemCollectionType:n};await Z(t.authorId,l),d(""),i()}else u(C.R.REQUIRED_FIELD)};return(0,l.jsxs)("form",{children:[(0,l.jsx)(N.Z,{onChange:e=>{d(e),u("")},value:r,error:m}),(0,l.jsxs)("span",{className:"mt-8 flex justify-start items-center",children:[(0,l.jsx)(c.Z,{onClick:h,children:"Update"}),(0,l.jsx)(c.Z,{context:"filledDark",className:"ml-2",onClick:i,children:"Cancel"})]})]})},T=s(9989),F=s(4240),E=s(6701),H=s(3917);let U=e=>{let t=new DOMParser,s=t.parseFromString(e,"text/html"),l="";for(let e of s.body.childNodes)"B"===e.nodeName?l+="<b class='font-bold'>".concat(e.textContent,"</b>"):"I"===e.nodeName?l+="<i>".concat(e.textContent,"</i>"):3===e.nodeType&&(l+=e.textContent);return l};var L=e=>{let[t,s]=(0,a.useState)(0),l=(0,a.useRef)(null),n=(0,a.useMemo)(()=>e.length>400,[e]),[c,i]=(0,a.useState)(!1),[o,r]=(0,a.useState)(!1),d=n&&!c&&o;return(0,a.useEffect)(()=>{l.current&&s(l.current.scrollHeight),c?r(!1):setTimeout(()=>{r(!0)},500)},[c]),{isContentOpen:c,contentHeight:t,contentRef:l,isShowTruncateDots:d,isLongReviewContent:n,toggleReviewContentLength:()=>{i(!c)}}},M=e=>{let[t,s]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{e||s(!1)},[e]),{isShowEditForm:t,showEditReviewForm:()=>{s(!0)},closeEditReviewForm:()=>{s(!1)}}},O=s(7338),D=e=>{let[t,s]=(0,a.useState)(!1),[l,n]=(0,a.useState)({userId:"",photoURL:"",displayName:""});return(0,a.useEffect)(()=>{(0,O.s)(e).then(e=>{n({userId:e.info.id,photoURL:e.info.photoURL,displayName:e.info.displayName})}).then(()=>{s(!0)})},[]),{isMounted:t,authorInfo:l}};let _=(e,t,s,l,n)=>{let c="users/".concat(e,"/collection/").concat(l,"/").concat(n,"/").concat(t),a="reviewsReactions/".concat(n,"/").concat(s,"/").concat(l,"/").concat(t),i=(0,f.iH)(v.F,c),o=(0,f.iH)(v.F,a);return new Promise(async e=>{let t=!1;(0,f.Od)(i).then(()=>{(0,f.Od)(o).then(()=>{t=!0})}),e(t)})},z=async(e,t)=>{let{reviewedItemId:s,userId:l,collectionType:n,reviewedItemCollectionType:c}=t,a="users/".concat(l,"/collection/").concat(n,"/").concat(c,"/").concat(e),i="".concat(c,"/").concat(s,"/").concat(n,"/").concat(e),o=(0,f.iH)(v.F,a),r=(0,f.iH)(v.F,i);return new Promise(async t=>{let a=!1;if(n===S.zS.reviews){let t="users/".concat(l,"/collection/replies/").concat(c,"/"),n="".concat(c,"/").concat(s,"/replies/"),a=(0,f.iH)(v.F,t),i=(0,f.iH)(v.F,n),o=async function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=t?await (0,f.U2)(a):await (0,f.U2)(i);n.exists()&&n.forEach(n=>{let a=n.val();if(a.reviewId===e){let e=t?"users/".concat(l,"/collection/replies/").concat(c,"/").concat(n.key):"".concat(c,"/").concat(s,"/replies/").concat(n.key),a=(0,f.iH)(v.F,e);(0,f.Od)(a)}})};await o(),await o(!0)}(0,f.Od)(o).then(()=>{(0,f.Od)(r).then(()=>_(l,e,s,n,c)).then(()=>{a=!0})}),t(a)})};var Q=e=>{let{reviewedItemId:t,userId:s,reply:n,collectionType:i,onReply:r,isCollectionItem:m}=e,{content:h,id:x,created_at:p,authorId:f,replyToUser:v}=n,w=(0,a.useMemo)(()=>o()(p).format("MMM Do YY"),[p]),j=s===f,{isMounted:y,authorInfo:k}=D(f),{isShowEditForm:I,showEditReviewForm:b,closeEditReviewForm:N}=M(s),{isContentOpen:C,contentHeight:Z,contentRef:O,isShowTruncateDots:_,isLongReviewContent:Q,toggleReviewContentLength:P}=L(h);return(0,l.jsx)(E.Z,{in:y,timeout:500,classNames:"fade",unmountOnExit:!0,children:(0,l.jsxs)("span",{className:"mb-4 p-2 md:p-4 bg-gray-800 rounded-md border-gray-500 relative last:mb-0 block",children:[j&&(0,l.jsxs)(T.Z,{children:[(0,l.jsx)(F.Z,{label:"Edit",icon:u.Yai,onClick:b}),(0,l.jsx)(F.Z,{label:"Delete",icon:u.$aW,onClick:()=>{let e={reviewedItemId:t,userId:s,collectionType:S.zS.replies,reviewedItemCollectionType:i};z(x,e)}})]}),(0,l.jsx)("span",{className:"flex mb-2 max-w-[calc(100%-54px)]",children:(0,l.jsxs)("span",{className:"flex items-center w-full",children:[(0,l.jsx)(H.Z,{userId:k.userId,photoURL:k.photoURL,isLinkToProfile:!m}),(0,l.jsxs)("span",{className:"w-full max-w-[calc(100%-54px)]",children:[(0,l.jsx)("span",{className:"truncate mb-1 min-h-[22.5px] text-lg font-semibold leading-tight block",children:k.displayName}),(0,l.jsx)("span",{className:"text-xs block",children:w})]})]})}),(0,l.jsx)("span",{children:I?(0,l.jsx)(R,{editedItem:n,reviewedItemId:t,reviewedItemCollectionType:i,onFormClose:N,isReplyItem:!0}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("span",{className:"mb-4 block",children:[(0,l.jsx)("span",{style:{maxHeight:C?Z:"3rem"},ref:O,className:"overflow-hidden transition-[max-height] duration-500",children:(0,l.jsxs)("span",{className:d()(_&&"line-clamp-2"),children:[(0,l.jsx)("span",{className:"mr-1 font-semibold",children:"".concat(v,",")}),(0,l.jsx)("span",{dangerouslySetInnerHTML:{__html:U(h)},className:d()(_&&"line-clamp-2")})]})}),Q&&(0,l.jsx)(c.Z,{context:"text",onClick:P,children:C?"Hide":"Show more"})]}),(0,l.jsx)(g,{reviewId:x,reviewedItemId:t,userId:s,collectionType:S.zS.replies,onReply:()=>r(k.displayName),reviewedItemCollectionType:i})]})})]})})};let P=(e,t)=>{let{reviewId:s,oldItems:l,setItems:n,reviewedItemCollectionType:c}=t,a="".concat(c,"/").concat(e,"/replies/"),i=(0,f.iH)(v.F,a),o=(0,f.yv)(i,e=>{let t=e.val();l.some(e=>e.id===t.id)||t.reviewId!==s||n(e=>[t,...e])}),r=(0,f.MQ)(i,e=>{let t=e.val();n(e=>e.filter(e=>e.id!==t.id))}),d=(0,f.Jr)(i,e=>{let t=e.val();n(e=>{let s=e.findIndex(e=>e.id===t.id);return -1!==s?(e[s]=t,[...e]):e})});return()=>{o(),r(),d()}};var Y=(e,t,s)=>{let[l,n]=(0,a.useState)(2),[c,i]=(0,a.useState)([]),o=l<c.length,r=c.length>2,{collectionType:d,reviewId:m,reviewedItemId:u}=t;return(0,a.useEffect)(()=>{i(e)},[e]),(0,a.useEffect)(()=>{if(s){let t=P(u,{reviewId:m,oldItems:e,setItems:i,reviewedItemCollectionType:d});return()=>{t()}}},[e,s,u,m]),{itemsToShow:c,maxReviewsLength:l,isShowMoreButton:r,buttonText:o?"Show more":"Show less",handleItemsToShowLength:()=>{let e=o?Math.min(l+2,c.length):2;n(e)}}},G=e=>{let{reviewedItemId:t,userId:s,reviewId:n,replies:a,onReply:i,collectionType:o,isCollectionList:r=!1}=e,{itemsToShow:d,maxReviewsLength:m,isShowMoreButton:u,buttonText:h,handleItemsToShowLength:x}=Y(a,{collectionType:o,reviewedItemId:t,reviewId:n},s);return d.length?(0,l.jsxs)("span",{className:"mt-4 block",children:[d.slice(0,m).map(e=>(0,l.jsx)(Q,{reply:e,userId:s,reviewedItemId:t,onReply:i,isCollectionItem:r,collectionType:o},e.id)),u&&(0,l.jsx)(c.Z,{className:"mx-auto",context:"empty",onClick:x,children:h})]}):null},J=s(8642),$=s(1664),V=s.n($),A=s(8878),B=s(1084);let W=async(e,t,s)=>{let l="".concat(s,"/").concat(e,"/replies/"),n=(0,f.iH)(v.F,l);try{let e=await (0,f.U2)(n),s=[];return e.exists()&&e.forEach(e=>{let l=e.val();l.reviewId===t&&s.push(l)}),s}catch(e){return[]}};var q=(e,t)=>{let[s,l]=(0,a.useState)([]),[n,c]=(0,a.useState)({userId:"",photoURL:"",displayName:""}),[i,o]=(0,a.useState)(!1),{id:r,authorId:d,reviewedItemId:m,collectionType:u}=e,h=!!d;return(0,a.useEffect)(()=>{W(m,r,u).then(e=>{l(e)})},[]),(0,a.useEffect)(()=>{h?(0,O.s)(d).then(e=>{c({userId:e.info.id,photoURL:e.info.photoURL,displayName:e.info.displayName})}).then(()=>{o(!0)}):o(!0)},[h]),{isMounted:i,replies:s,isItemFromDB:h,authorInfo:n,removeReviewCard:()=>{o(!1),setTimeout(()=>{let e={reviewedItemId:m,userId:t,collectionType:S.zS.reviews,reviewedItemCollectionType:u};z(r,e)},500)}}},X=e=>{let[t,s]=(0,a.useState)(!1),[l,n]=(0,a.useState)("");return(0,a.useEffect)(()=>{n(e)},[e]),{replyToUser:l,isShowReplyForm:t,showReplyForm:()=>{s(!0)},closeReplyForm:()=>{n(e),s(!1)},makeReplyToUser:e=>{s(!0),n(e)}}},K=e=>{let{collectionType:t,review:s,defaultCardReviewedId:n,isLinkToMovie:i=!1,isCollectionItem:r=!1}=e,{userId:m}=(0,J.a)(),{content:h,id:x,author:p,created_at:f,avatar_path:v,authorId:w,reviewedItemId:j}=s,{isMounted:y,replies:k,isItemFromDB:I,authorInfo:N,removeReviewCard:C}=q({id:x,authorId:w,reviewedItemId:j,collectionType:t},m),{isShowEditForm:Z,showEditReviewForm:O,closeEditReviewForm:D}=M(m),{replyToUser:_,isShowReplyForm:z,showReplyForm:Q,closeReplyForm:P,makeReplyToUser:Y}=X(I?N.displayName:p),$=m===w&&I,W=(0,a.useMemo)(()=>o()(f).format("MMM Do YY"),[f]),{isContentOpen:K,contentHeight:ee,contentRef:et,isShowTruncateDots:es,isLongReviewContent:el,toggleReviewContentLength:en}=L(h),ec=(0,l.jsxs)("span",{className:"p-2 md:p-4 gap-4 bg-gray-900 relative duration-300 flex flex-wrap md:flex-nowrap",children:[$&&(0,l.jsxs)(T.Z,{children:[(0,l.jsx)(F.Z,{label:"Edit",icon:u.Yai,onClick:O}),(0,l.jsx)(F.Z,{label:"Delete",icon:u.$aW,onClick:C})]}),i&&(0,l.jsx)(A.Z,{itemId:j,collectionType:t}),(0,l.jsxs)("span",{className:"w-full",children:[(0,l.jsx)("span",{className:"flex mb-2 max-w-[calc(100%-54px)]",children:(0,l.jsxs)("span",{className:"flex items-center",children:[(0,l.jsx)(H.Z,{userId:I?N.userId:void 0,photoURL:I?N.photoURL:B.qX.replace("{imageSrc}",v),isLinkToProfile:I&&!i}),(0,l.jsxs)("span",{children:[(0,l.jsx)("span",{className:"mb-1 min-h-[22.5px] text-lg font-semibold leading-tight block",children:I?N.displayName:p}),(0,l.jsx)("span",{className:"text-xs block",children:W})]})]})}),(0,l.jsx)("span",{className:"flex flex-col h-[calc(100%-50.5px)]",children:Z?(0,l.jsx)(R,{editedItem:s,reviewedItemId:null!=n?n:j,reviewedItemCollectionType:t,onFormClose:D}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("span",{className:"block mb-4",children:[(0,l.jsx)("span",{style:{maxHeight:K?ee:"3rem"},ref:et,className:"overflow-hidden transition-[max-height] duration-500 block text-base",children:(0,l.jsx)("span",{dangerouslySetInnerHTML:{__html:U(h)},className:d()(es&&"line-clamp-2")})}),el&&(0,l.jsx)(c.Z,{context:"text",onClick:en,children:K?"Hide":"Show more"})]}),(0,l.jsx)(g,{reviewId:x,reviewedItemId:null!=n?n:j,userId:m,onReply:Q,collectionType:S.zS.reviews,reviewedItemCollectionType:t}),(0,l.jsx)(G,{reviewedItemId:null!=n?n:j,userId:m,reviewId:x,replies:k,onReply:Y,collectionType:t,isCollectionList:r}),z&&(0,l.jsx)(b.Z,{reviewAuthorId:s.authorId,reviewedItemId:null!=n?n:j,reviewedItemCollectionType:t,userId:m,reviewId:x,replyToUser:_,onFormClose:P,isReplyItem:!0})]})})]})]});return(0,l.jsx)(E.Z,{in:y,timeout:500,classNames:"fade",unmountOnExit:!0,children:i?(0,l.jsx)(V(),{href:"/movie/[id]",as:"/movie/".concat(j),className:"mb-4 block last:mb-0",children:ec}):(0,l.jsx)("span",{className:"mb-4 block last:mb-0",children:ec})})},ee=s(4033),et=s(4641);let es=(e,t)=>{let{oldItems:s,setItems:l,reviewedItemCollectionType:n}=t,c="".concat(n,"/").concat(e,"/reviews/"),a=(0,f.iH)(v.F,c),i=(0,f.yv)(a,e=>{let t=e.val();s.some(e=>e.id===t.id)||l(e=>[t,...e])}),o=(0,f.MQ)(a,e=>{let t=e.val();l(e=>e.filter(e=>e.id!==t.id))}),r=(0,f.Jr)(a,e=>{let t=e.val();l(e=>{let s=e.findIndex(e=>e.id===t.id);return -1!==s?(e[s]=t,[...e]):e})});return()=>{i(),o(),r()}},el=(e,t,s)=>{let l=(0,f.iH)(v.F,"users/".concat(t,"/collection/replies/tv")),n=(0,f.iH)(v.F,"users/".concat(t,"/collection/reviews/tv")),c=(0,f.iH)(v.F,"users/".concat(t,"/collection/replies/movie")),a=(0,f.iH)(v.F,"users/".concat(t,"/collection/reviews/movie")),i=async i=>{let o=i.val(),r=[],d=[];o.reviewedItemCollectionType===S.zS.movie?(r=Object.values((await (0,f.U2)((0,f.IO)(c))).val()||{}),d=Object.values((await (0,f.U2)((0,f.IO)(a))).val()||{})):(r=Object.values((await (0,f.U2)((0,f.IO)(l))).val()||{}),d=Object.values((await (0,f.U2)((0,f.IO)(n))).val()||{}));let m=d.find(e=>e.id===o.reviewId),u=!r.some(e=>e.reviewId===o.reviewId),h=m&&m.authorId===e;(!u||h||t!==e)&&m||s(e=>e.filter(e=>e.id!==o.reviewId))},o=(0,f.MQ)(l,i),r=(0,f.MQ)(c,i);return()=>{o(),r()}},en=(e,t)=>{let s=(0,f.iH)(v.F,"users/".concat(e,"/collection/reviews/tv")),l=(0,f.iH)(v.F,"users/".concat(e,"/collection/reviews/movie")),n=e=>{let s=e.val();t(e=>e.filter(e=>e.id!==s.id))},c=e=>{let s=e.val();t(e=>{let t=e.findIndex(e=>e.id===s.id);return -1!==t?(e[t]=s,[...e]):e})},a=(0,f.MQ)(s,n),i=(0,f.Jr)(s,c),o=(0,f.MQ)(l,n),r=(0,f.Jr)(l,c);return()=>{a(),i(),o(),r()}};var ec=(e,t,s)=>{let{userId:l}=(0,J.a)(),[n,c]=(0,a.useState)(3),[i,o]=(0,a.useState)(e),[r,d]=(0,a.useState)([]),[m,u]=(0,a.useState)([]),h=n<i.filter(e=>void 0!==e.id).length,x=i.length>3,{collectionType:p,isCollectionList:f,reviewedItemId:v,collectionOwnerId:w}=t,j=()=>{let t=[],s=[];e.forEach(e=>{e.authorId?t.push(e):s.push(e)}),d(t),u(s)};return(0,a.useEffect)(()=>{j()},[e]),(0,a.useEffect)(()=>{let e=[...r,...m];o(e)},[r,m]),(0,a.useEffect)(()=>{if(l){if(f){let e=f?l:v,t=en(e,o);return()=>{t()}}{let e=f?l:v,t=es(e,{oldItems:r,setItems:d,reviewedItemCollectionType:p});return()=>{t()}}}},[r,l]),(0,a.useEffect)(()=>{if(l&&f){let e=el(l,w,o);return()=>{e()}}},[l]),{itemsToShow:i,isShowMoreButton:x,buttonText:h?"Show more":"Show less",maxReviewsLength:n,handleItemsToShowLength:()=>{h||s();let e=h?Math.min(n+3,i.length):3;h?c(e):setTimeout(()=>{c(e)},600)}}},ea=e=>{let{reviews:t,collectionType:s,reviewedItemId:a,isCollectionList:i=!1,collectionOwnerId:o,className:r}=e,{listRef:m,scrollToTop:u}=(0,et.Z)(100),{itemsToShow:h,isShowMoreButton:x,buttonText:p,maxReviewsLength:f,handleItemsToShowLength:v}=ec(t,{collectionType:s,isCollectionList:i,reviewedItemId:a,collectionOwnerId:o},u);return h.length?(0,l.jsxs)("div",{ref:m,className:d()("mb-16",r),children:[(0,l.jsx)(n.Z,{children:"Reviews"}),(0,l.jsxs)("div",{children:[h.slice(0,f).map(e=>(0,l.jsx)(K,{review:e,collectionType:null!=s?s:e.reviewedItemCollectionType,defaultCardReviewedId:a,isLinkToMovie:i,isCollectionItem:i},e.id)),x&&(0,l.jsx)(c.Z,{className:"mx-auto",context:"empty",onClick:v,children:p})]})]}):(0,l.jsx)(ee.Z,{title:"Reviews",text:i?"Please write a review before you can see it here":void 0,className:i?"border border-gray-500 !mb-4 -my-12 p-4 last:mb-0":void 0})}},3851:function(e,t,s){var l=s(7294),n=s(4641);t.Z=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,[c,a]=(0,l.useState)([]),{listRef:i,scrollToTop:o}=(0,n.Z)(s),r=c.length>t,d=e.length>t;return(0,l.useEffect)(()=>{let s=e.slice(0,t);a(s)},[e]),{itemsToShow:c,getItemsToShow:()=>{r&&o();let s=r?e.slice(0,t):e;r?setTimeout(()=>{a(s)},600):a(s)},isShowMoreButton:d,buttonText:r?"Show less":"Show all",listRef:i}}},4641:function(e,t,s){var l=s(7294);t.Z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=(0,l.useRef)(null);return{listRef:t,scrollToTop:()=>{if(t.current){let s=t.current.getBoundingClientRect().top;window.scrollTo({top:window.pageYOffset+s-e,behavior:"smooth"})}}}}}}]);